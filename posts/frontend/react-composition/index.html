<!doctype html><html lang=zh-tw dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>React 解決中文輸入法 | Simba's Blog</title><meta name=keywords content><meta name=description content="今天在開發晶晶體產生器的時候，發現中文輸入總是有問題，這時候我想起以前看過 Hackmd 官方的一篇 blog，提到中文輸入法如果有問題，可能和組字事件有關。於是就開始研究。首先我將以下設定加入 textarea 裡觀察組字事件的行為
onCompositionStart={(e) => console.log('compositionStart', e.data)} onCompositionEnd={(e) => console.log('compositionEnd', e.data)} onCompositionUpdate={(e) => console.log('compositionUpdate', e.data)} 當我打「今天我想要吃蛋餅」的時候，console 長這樣
compositionStart <empty string> compositionUpdate ㄐ compositionUpdate ㄐㄧ compositionUpdate ㄐㄧㄣ compositionUpdate 今 compositionUpdate 今ㄊ compositionUpdate 今ㄊㄧ compositionUpdate 今ㄊㄧㄢ compositionUpdate 今天 compositionUpdate 今天ㄨ compositionUpdate 今天ㄨㄛ compositionUpdate 今天ㄒㄨㄛ compositionUpdate 今天ㄒㄨ compositionUpdate 今天ㄒ compositionUpdate 今天 compositionUpdate 今天ㄨ compositionUpdate 今天ㄨㄛ compositionUpdate 今天我 compositionUpdate 今天我ㄒ compositionUpdate 今天我ㄒㄧ compositionUpdate 今天我ㄒㄧㄤ compositionUpdate 今天我想 compositionUpdate 今天我想ㄧ compositionUpdate 今天我想ㄧㄠ compositionUpdate 今天我想要 compositionUpdate 今天我想要ㄔ compositionUpdate 今天我想要吃 compositionUpdate 今天我想要吃ㄉ compositionUpdate 今天我想要吃ㄉㄢ compositionUpdate 今天我想要吃但 compositionUpdate 今天我想要吃但ㄅ compositionUpdate 今天我想要吃但ㄅㄧ compositionUpdate 今天我想要吃但ㄅㄧㄥ compositionUpdate 今天我想要吃蛋餅 compositionUpdate <empty string> compositionEnd <empty string> 根據實驗結果，我猜我們可以用 onCompositionUpdate 事件來修正，於是現在 textarea 變成這樣"><meta name=author content="simba-fs"><link rel=canonical href=https://blog.simbafs.cc/posts/frontend/react-composition/><link crossorigin=anonymous href=/assets/css/stylesheet.min.48a18943c2fc15c38a372b8dde1f5e5dc0bc64fa6cb90f5a817d2f8c76b7f3ae.css integrity="sha256-SKGJQ8L8FcOKNyuN3h9eXcC8ZPpsuQ9agX0vjHa3864=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.e85ad0406048e8176e1c7661b25d5c69297ddfe41dc4124cf75ecb99a4f7b3d1.js integrity="sha256-6FrQQGBI6BduHHZhsl1caSl93+QdxBJM917LmaT3s9E=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.simbafs.cc/images/icon/icon.png><link rel=icon type=image/png sizes=16x16 href=https://blog.simbafs.cc/images/icon/icon-16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.simbafs.cc/images/icon/icon-32.png><link rel=apple-touch-icon href=https://blog.simbafs.cc/images/icon/icon.png><link rel=mask-icon href=https://blog.simbafs.cc/images/icon/icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css integrity=sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js integrity=sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-175823992-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="React 解決中文輸入法"><meta property="og:description" content="今天在開發晶晶體產生器的時候，發現中文輸入總是有問題，這時候我想起以前看過 Hackmd 官方的一篇 blog，提到中文輸入法如果有問題，可能和組字事件有關。於是就開始研究。首先我將以下設定加入 textarea 裡觀察組字事件的行為
onCompositionStart={(e) => console.log('compositionStart', e.data)} onCompositionEnd={(e) => console.log('compositionEnd', e.data)} onCompositionUpdate={(e) => console.log('compositionUpdate', e.data)} 當我打「今天我想要吃蛋餅」的時候，console 長這樣
compositionStart <empty string> compositionUpdate ㄐ compositionUpdate ㄐㄧ compositionUpdate ㄐㄧㄣ compositionUpdate 今 compositionUpdate 今ㄊ compositionUpdate 今ㄊㄧ compositionUpdate 今ㄊㄧㄢ compositionUpdate 今天 compositionUpdate 今天ㄨ compositionUpdate 今天ㄨㄛ compositionUpdate 今天ㄒㄨㄛ compositionUpdate 今天ㄒㄨ compositionUpdate 今天ㄒ compositionUpdate 今天 compositionUpdate 今天ㄨ compositionUpdate 今天ㄨㄛ compositionUpdate 今天我 compositionUpdate 今天我ㄒ compositionUpdate 今天我ㄒㄧ compositionUpdate 今天我ㄒㄧㄤ compositionUpdate 今天我想 compositionUpdate 今天我想ㄧ compositionUpdate 今天我想ㄧㄠ compositionUpdate 今天我想要 compositionUpdate 今天我想要ㄔ compositionUpdate 今天我想要吃 compositionUpdate 今天我想要吃ㄉ compositionUpdate 今天我想要吃ㄉㄢ compositionUpdate 今天我想要吃但 compositionUpdate 今天我想要吃但ㄅ compositionUpdate 今天我想要吃但ㄅㄧ compositionUpdate 今天我想要吃但ㄅㄧㄥ compositionUpdate 今天我想要吃蛋餅 compositionUpdate <empty string> compositionEnd <empty string> 根據實驗結果，我猜我們可以用 onCompositionUpdate 事件來修正，於是現在 textarea 變成這樣"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.simbafs.cc/posts/frontend/react-composition/"><meta property="og:image" content="https://blog.simbafs.cc/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-05T16:59:44+08:00"><meta property="article:modified_time" content="2022-02-05T16:59:44+08:00"><meta property="og:site_name" content="Simba 的喵窩"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.simbafs.cc/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="React 解決中文輸入法"><meta name=twitter:description content="今天在開發晶晶體產生器的時候，發現中文輸入總是有問題，這時候我想起以前看過 Hackmd 官方的一篇 blog，提到中文輸入法如果有問題，可能和組字事件有關。於是就開始研究。首先我將以下設定加入 textarea 裡觀察組字事件的行為
onCompositionStart={(e) => console.log('compositionStart', e.data)} onCompositionEnd={(e) => console.log('compositionEnd', e.data)} onCompositionUpdate={(e) => console.log('compositionUpdate', e.data)} 當我打「今天我想要吃蛋餅」的時候，console 長這樣
compositionStart <empty string> compositionUpdate ㄐ compositionUpdate ㄐㄧ compositionUpdate ㄐㄧㄣ compositionUpdate 今 compositionUpdate 今ㄊ compositionUpdate 今ㄊㄧ compositionUpdate 今ㄊㄧㄢ compositionUpdate 今天 compositionUpdate 今天ㄨ compositionUpdate 今天ㄨㄛ compositionUpdate 今天ㄒㄨㄛ compositionUpdate 今天ㄒㄨ compositionUpdate 今天ㄒ compositionUpdate 今天 compositionUpdate 今天ㄨ compositionUpdate 今天ㄨㄛ compositionUpdate 今天我 compositionUpdate 今天我ㄒ compositionUpdate 今天我ㄒㄧ compositionUpdate 今天我ㄒㄧㄤ compositionUpdate 今天我想 compositionUpdate 今天我想ㄧ compositionUpdate 今天我想ㄧㄠ compositionUpdate 今天我想要 compositionUpdate 今天我想要ㄔ compositionUpdate 今天我想要吃 compositionUpdate 今天我想要吃ㄉ compositionUpdate 今天我想要吃ㄉㄢ compositionUpdate 今天我想要吃但 compositionUpdate 今天我想要吃但ㄅ compositionUpdate 今天我想要吃但ㄅㄧ compositionUpdate 今天我想要吃但ㄅㄧㄥ compositionUpdate 今天我想要吃蛋餅 compositionUpdate <empty string> compositionEnd <empty string> 根據實驗結果，我猜我們可以用 onCompositionUpdate 事件來修正，於是現在 textarea 變成這樣"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"posts","item":"https://blog.simbafs.cc/posts/"},{"@type":"ListItem","position":2,"name":"frontend","item":"https://blog.simbafs.cc/posts/frontend/"},{"@type":"ListItem","position":3,"name":"React 解決中文輸入法","item":"https://blog.simbafs.cc/posts/frontend/react-composition/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"React 解決中文輸入法","name":"React 解決中文輸入法","description":"今天在開發晶晶體產生器的時候，發現中文輸入總是有問題，這時候我想起以前看過 Hackmd 官方的一篇 blog，提到中文輸入法如果有問題，可能和組字事件有關。於是就開始研究。首先我將以下設定加入 textarea 裡觀察組字事件的行為\nonCompositionStart={(e) =\u0026gt; console.log(\u0026#39;compositionStart\u0026#39;, e.data)} onCompositionEnd={(e) =\u0026gt; console.log(\u0026#39;compositionEnd\u0026#39;, e.data)} onCompositionUpdate={(e) =\u0026gt; console.log(\u0026#39;compositionUpdate\u0026#39;, e.data)} 當我打「今天我想要吃蛋餅」的時候，console 長這樣\ncompositionStart \u0026lt;empty string\u0026gt; compositionUpdate ㄐ compositionUpdate ㄐㄧ compositionUpdate ㄐㄧㄣ compositionUpdate 今 compositionUpdate 今ㄊ compositionUpdate 今ㄊㄧ compositionUpdate 今ㄊㄧㄢ compositionUpdate 今天 compositionUpdate 今天ㄨ compositionUpdate 今天ㄨㄛ compositionUpdate 今天ㄒㄨㄛ compositionUpdate 今天ㄒㄨ compositionUpdate 今天ㄒ compositionUpdate 今天 compositionUpdate 今天ㄨ compositionUpdate 今天ㄨㄛ compositionUpdate 今天我 compositionUpdate 今天我ㄒ compositionUpdate 今天我ㄒㄧ compositionUpdate 今天我ㄒㄧㄤ compositionUpdate 今天我想 compositionUpdate 今天我想ㄧ compositionUpdate 今天我想ㄧㄠ compositionUpdate 今天我想要 compositionUpdate 今天我想要ㄔ compositionUpdate 今天我想要吃 compositionUpdate 今天我想要吃ㄉ compositionUpdate 今天我想要吃ㄉㄢ compositionUpdate 今天我想要吃但 compositionUpdate 今天我想要吃但ㄅ compositionUpdate 今天我想要吃但ㄅㄧ compositionUpdate 今天我想要吃但ㄅㄧㄥ compositionUpdate 今天我想要吃蛋餅 compositionUpdate \u0026lt;empty string\u0026gt; compositionEnd \u0026lt;empty string\u0026gt; 根據實驗結果，我猜我們可以用 onCompositionUpdate 事件來修正，於是現在 textarea 變成這樣","keywords":[],"articleBody":"今天在開發晶晶體產生器的時候，發現中文輸入總是有問題，這時候我想起以前看過 Hackmd 官方的一篇 blog，提到中文輸入法如果有問題，可能和組字事件有關。於是就開始研究。首先我將以下設定加入 textarea 裡觀察組字事件的行為\nonCompositionStart={(e) =\u003e console.log('compositionStart', e.data)} onCompositionEnd={(e) =\u003e console.log('compositionEnd', e.data)} onCompositionUpdate={(e) =\u003e console.log('compositionUpdate', e.data)} 當我打「今天我想要吃蛋餅」的時候，console 長這樣\ncompositionStart compositionUpdate ㄐ compositionUpdate ㄐㄧ compositionUpdate ㄐㄧㄣ compositionUpdate 今 compositionUpdate 今ㄊ compositionUpdate 今ㄊㄧ compositionUpdate 今ㄊㄧㄢ compositionUpdate 今天 compositionUpdate 今天ㄨ compositionUpdate 今天ㄨㄛ compositionUpdate 今天ㄒㄨㄛ compositionUpdate 今天ㄒㄨ compositionUpdate 今天ㄒ compositionUpdate 今天 compositionUpdate 今天ㄨ compositionUpdate 今天ㄨㄛ compositionUpdate 今天我 compositionUpdate 今天我ㄒ compositionUpdate 今天我ㄒㄧ compositionUpdate 今天我ㄒㄧㄤ compositionUpdate 今天我想 compositionUpdate 今天我想ㄧ compositionUpdate 今天我想ㄧㄠ compositionUpdate 今天我想要 compositionUpdate 今天我想要ㄔ compositionUpdate 今天我想要吃 compositionUpdate 今天我想要吃ㄉ compositionUpdate 今天我想要吃ㄉㄢ compositionUpdate 今天我想要吃但 compositionUpdate 今天我想要吃但ㄅ compositionUpdate 今天我想要吃但ㄅㄧ compositionUpdate 今天我想要吃但ㄅㄧㄥ compositionUpdate 今天我想要吃蛋餅 compositionUpdate compositionEnd 根據實驗結果，我猜我們可以用 onCompositionUpdate 事件來修正，於是現在 textarea 變成這樣\n\u003ctextarea className={style.input} value={t} onChange={(e) =\u003e setInput(() =\u003e e.target.value)} onCompositionUpdate={(e) =\u003e setInput(() =\u003e e.data)} onContextMenu={handleContext} /\u003e 如此一來就解決中文輸入的問題了！但是目前這個版本只能解決「一次」的中文輸入，也就是說如果中斷的話，之前的將會被清空。這個問題可以修改 onCompositionUpdate 的處理函式解決（有待研究）\nUpdate: 2022/02/08\n目前部份解決接續輸入的問題，但是只能從最後面繼續，不能從中間插入。目前的 textarea 長這樣\nconst [previousInput, setPreviousInput] = useState(''); \u003ctextarea className={style.input} value={t} onChange={e =\u003e setInput(() =\u003e e.target.value)} onCompositionUpdate={e =\u003e setInput(() =\u003e previousInput + e.data)} onCompositionStart={() =\u003e setPreviousInput(() =\u003e input)} onContextMenu={handleContext} /\u003e ","wordCount":"150","inLanguage":"zh-tw","datePublished":"2022-02-05T16:59:44+08:00","dateModified":"2022-02-05T16:59:44+08:00","author":{"@type":"Person","name":"simba-fs"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.simbafs.cc/posts/frontend/react-composition/"},"publisher":{"@type":"Organization","name":"Simba's Blog","logo":{"@type":"ImageObject","url":"https://blog.simbafs.cc/images/icon/icon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.simbafs.cc/ accesskey=h title="Home (Alt + H)"><img src=https://blog.simbafs.cc/images/icon/icon.png alt=logo aria-label=logo height=35>Home</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://blog.simbafs.cc/posts/ title=Categories><span>Categories</span></a></li><li><a href=https://blog.simbafs.cc/archive/ title=Archives><span>Archives</span></a></li><li><a href=https://blog.simbafs.cc/resource/ title=Resource><span>Resource</span></a></li><li><a href=https://blog.simbafs.cc/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.simbafs.cc/>首頁</a>&nbsp;»&nbsp;<a href=https://blog.simbafs.cc/posts/>posts</a>&nbsp;»&nbsp;<a href=https://blog.simbafs.cc/posts/frontend/>frontend</a></div><h1 class=post-title>React 解決中文輸入法</h1><div class=post-meta><span title='2022-02-05 16:59:44 +0800 +0800'>2022-February-5</span>&nbsp;·&nbsp;1 分鐘&nbsp;·&nbsp;simba-fs</div></header><div class=post-content><p>今天在開發<a href=https://github.com/simba-fs/JingJing>晶晶體產生器</a>的時候，發現中文輸入總是有問題，這時候我想起以前看過 Hackmd 官方的<a href=https://hackmd.io/@hackmd/CompositionEvent>一篇 blog</a>，提到中文輸入法如果有問題，可能和組字事件有關。於是就開始研究。首先我將以下設定加入 <code>textarea</code> 裡觀察組字事件的行為</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#a6e22e>onCompositionStart</span><span style=color:#f92672>=</span>{(<span style=color:#a6e22e>e</span>) =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;compositionStart&#39;</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>data</span>)}
</span></span><span style=display:flex><span><span style=color:#a6e22e>onCompositionEnd</span><span style=color:#f92672>=</span>{(<span style=color:#a6e22e>e</span>) =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;compositionEnd&#39;</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>data</span>)}
</span></span><span style=display:flex><span><span style=color:#a6e22e>onCompositionUpdate</span><span style=color:#f92672>=</span>{(<span style=color:#a6e22e>e</span>) =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;compositionUpdate&#39;</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>data</span>)}
</span></span></code></pre></div><p>當我打「今天我想要吃蛋餅」的時候，console 長這樣</p><pre tabindex=0><code>compositionStart &lt;empty string&gt; 
compositionUpdate ㄐ 
compositionUpdate ㄐㄧ 
compositionUpdate ㄐㄧㄣ 
compositionUpdate 今
compositionUpdate 今ㄊ
compositionUpdate 今ㄊㄧ
compositionUpdate 今ㄊㄧㄢ
compositionUpdate 今天
compositionUpdate 今天ㄨ
compositionUpdate 今天ㄨㄛ 
compositionUpdate 今天ㄒㄨㄛ 
compositionUpdate 今天ㄒㄨ 
compositionUpdate 今天ㄒ 
compositionUpdate 今天 
compositionUpdate 今天ㄨ 
compositionUpdate 今天ㄨㄛ 
compositionUpdate 今天我 
compositionUpdate 今天我ㄒ 
compositionUpdate 今天我ㄒㄧ 
compositionUpdate 今天我ㄒㄧㄤ 
compositionUpdate 今天我想 
compositionUpdate 今天我想ㄧ 
compositionUpdate 今天我想ㄧㄠ 
compositionUpdate 今天我想要 
compositionUpdate 今天我想要ㄔ 
compositionUpdate 今天我想要吃 
compositionUpdate 今天我想要吃ㄉ 
compositionUpdate 今天我想要吃ㄉㄢ 
compositionUpdate 今天我想要吃但 
compositionUpdate 今天我想要吃但ㄅ 
compositionUpdate 今天我想要吃但ㄅㄧ 
compositionUpdate 今天我想要吃但ㄅㄧㄥ 
compositionUpdate 今天我想要吃蛋餅 
compositionUpdate &lt;empty string&gt; 
compositionEnd &lt;empty string&gt;
</code></pre><p>根據實驗結果，我猜我們可以用 <code>onCompositionUpdate</code> 事件來修正，於是現在 <code>textarea</code> 變成這樣</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span>&lt;<span style=color:#f92672>textarea</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>className</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>input</span>}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>value</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>t</span>}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>onChange</span><span style=color:#f92672>=</span>{(<span style=color:#a6e22e>e</span>) =&gt; <span style=color:#a6e22e>setInput</span>(() =&gt; <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>value</span>)}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>onCompositionUpdate</span><span style=color:#f92672>=</span>{(<span style=color:#a6e22e>e</span>) =&gt; <span style=color:#a6e22e>setInput</span>(() =&gt; <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>data</span>)}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>onContextMenu</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>handleContext</span>}
</span></span><span style=display:flex><span>/&gt;
</span></span></code></pre></div><p>如此一來就解決中文輸入的問題了！但是目前這個版本只能解決「一次」的中文輸入，也就是說如果中斷的話，之前的將會被清空。這個問題可以修改 <code>onCompositionUpdate</code> 的處理函式解決（有待研究）</p><hr><blockquote><p>Update: 2022/02/08</p></blockquote><p>目前部份解決接續輸入的問題，但是只能從最後面繼續，不能從中間插入。目前的 <code>textarea</code> 長這樣</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>previousInput</span>, <span style=color:#a6e22e>setPreviousInput</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>(<span style=color:#e6db74>&#39;&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>textarea</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>className</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>input</span>}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>value</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>t</span>}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>onChange</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>e</span> =&gt; <span style=color:#a6e22e>setInput</span>(() =&gt; <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>value</span>)}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>onCompositionUpdate</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>e</span> =&gt; <span style=color:#a6e22e>setInput</span>(() =&gt; <span style=color:#a6e22e>previousInput</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>data</span>)}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>onCompositionStart</span><span style=color:#f92672>=</span>{() =&gt; <span style=color:#a6e22e>setPreviousInput</span>(() =&gt; <span style=color:#a6e22e>input</span>)}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>onContextMenu</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>handleContext</span>}
</span></span><span style=display:flex><span>/&gt;
</span></span></code></pre></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://blog.simbafs.cc/posts/golang/plguin/><span class=title>« 上一篇</span><br><span>Golang Plguin</span></a>
<a class=next href=https://blog.simbafs.cc/posts/other/latex-starter/><span class=title>下一篇 »</span><br><span>LaTeX Starter</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://blog.simbafs.cc/>Simba's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="複製";function s(){t.innerText="已複製！",setTimeout(()=>{t.innerText="複製"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>