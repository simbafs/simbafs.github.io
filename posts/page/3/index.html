<!doctype html><html lang=zh-tw dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Posts | Simba's Blog</title>
<meta name=keywords content>
<meta name=description content="Posts - Simba's Blog">
<meta name=author content="simba-fs">
<link rel=canonical href=https://blog.simba-fs.dev/posts/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.b9ff4cc257e914dab489bd18086151800e18f91456a5174bf28489210227a659.css integrity="sha256-uf9MwlfpFNq0ib0YCGFRgA4Y+RRWpRdL8oSJIQInplk=" rel="preload stylesheet" as=style>
<link rel=preload href=/images/icon/icon.png as=image>
<link rel=icon href=https://blog.simba-fs.dev/images/icon/icon.png>
<link rel=icon type=image/png sizes=16x16 href=https://blog.simba-fs.dev/images/icon/icon-16.png>
<link rel=icon type=image/png sizes=32x32 href=https://blog.simba-fs.dev/images/icon/icon-32.png>
<link rel=apple-touch-icon href=https://blog.simba-fs.dev/images/icon/icon.png>
<link rel=mask-icon href=https://blog.simba-fs.dev/images/icon/icon.png>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.89.4">
<link rel=alternate type=application/rss+xml href=https://blog.simba-fs.dev/posts/index.xml>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-175823992-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="Posts">
<meta property="og:description" content>
<meta property="og:type" content="website">
<meta property="og:url" content="https://blog.simba-fs.dev/posts/"><meta property="og:image" content="https://blog.simba-fs.dev/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="og:site_name" content="Simba's Blog">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://blog.simba-fs.dev/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E">
<meta name=twitter:title content="Posts">
<meta name=twitter:description content>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.simba-fs.dev/posts/"}]}</script>
</head>
<body class=list id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<noscript>
<style type=text/css>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://blog.simba-fs.dev/ accesskey=h title="Home (Alt + H)">
<img src=/images/icon/icon.png alt=logo aria-label=logo height=35>Home</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://blog.simba-fs.dev/categories/ title=Categories>
<span>Categories</span>
</a>
</li>
<li>
<a href=https://blog.simba-fs.dev/tags/ title=Tags>
<span>Tags</span>
</a>
</li>
<li>
<a href=https://blog.simba-fs.dev/archive/ title=Archives>
<span>Archives</span>
</a>
</li>
<li>
<a href=https://blog.simba-fs.dev/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<header class=page-header><div class=breadcrumbs><a href=https://blog.simba-fs.dev/>Home</a></div>
<h1>Posts</h1>
</header>
<article class=post-entry>
<header class=entry-header>
<h2>Mongoose Model</h2>
</header>
<section class=entry-content>
<p>Mongoose Model 環境設定 這是這次實驗用的 code
const mongoose = require('mongoose'); mongoose.connect('mongodb://127.0.0.1:27017', {useNewUrlParser: true, useUnifiedTopology: true}) .then(() => console.log('Connected to DB')) .catch(e => console.error(e)); const requiredString = { type: String, required: true } const UserSchema = new mongoose.Schema({ username: requiredString, password: requiredString }); const UserModel = mongoose.model('User', UserSchema); mongo db 用 docker 開一個實驗用的 server
version: '3' services: db: image: 'mongo' container_name: 'aurl-mongodb' volumes: - ./data/mongo:/data/db - ./data/dump:/dump ports: - '27017:27017' 取得原 schema 在一般操作的時候都是用 UserModel 在操作資料庫，當要取得 schema 的時候當然也是從他裡面找最方便，當然也可以把 schema 特別弄出來，但是有點麻煩，以這次的例子說明，原本的 UserSchema 會存在 UserModel....</p>
</section>
<footer class=entry-footer>2020-November-10&nbsp;·&nbsp;1 min&nbsp;·&nbsp;simba-fs</footer>
<a class=entry-link aria-label="post link to Mongoose Model" href=https://blog.simba-fs.dev/posts/nodejs/mongoose-model/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>docker 基礎指令</h2>
</header>
<section class=entry-content>
<p>Install apt install docker docker.io docker-compose What is docker Docker 是一個容器化的技術，基本上使用的時候可以把他當成虛擬機，雖然他們的使用的技術完全不一樣。對新手來說，在 Docker 裡面有四個重要的名詞：dockerfile, docker image, docker container, docker-compose。
dockerfile
純文字檔，定義建立 docker image 的步驟，有點像是一個 bash shell。通常命名成 Dockerfile ，在 build 的時候會預設用這個，也可以用 -f 來指定其他的檔案。 docker image
這是透過 docker build 編譯出來的東西。可以想成 docker container 的藍圖，在 docker pull 的時候也是下載 docker image 而不是 dockerfile。基本上 image 裡面已經包括了編譯好的執行檔和基本的環境設定，所以在 docker 外面是不用做他設定的，這也是 docker 的魅力所在。 docker container
每個 docker image 可以產生很多個 container，也就是執行中的程式。在這裡你已經可以用 docker 來建立各種服務了。這裡也可以想像成虛擬機，用 docker exec -it container_name bash 可以進到 container 裡面(如果裡面有 bash 的話) docker-compose...</p>
</section>
<footer class=entry-footer>2020-September-10&nbsp;·&nbsp;1 min&nbsp;·&nbsp;simba-fs</footer>
<a class=entry-link aria-label="post link to docker 基礎指令" href=https://blog.simba-fs.dev/posts/linux/docker/docker-%E5%9F%BA%E7%A4%8E%E6%8C%87%E4%BB%A4/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>mxlinux boot with systemd</h2>
</header>
<section class=entry-content>
<p>問題 在 mxlinux 裡面，預設的 init 不是 systmed，這導致如果想用 systemctl 的時候就會跳出錯誤說
System has not been booted with systemd as init system 像是在安裝 mongodb-org 的時候他就要用到 systemctl 然後就會出錯。
解法 其實 mxlinux 已經幫我們想好解法了，在開機選項時選 Advence > Systemd 就會以 systemd 開機</p>
</section>
<footer class=entry-footer>2020-September-5&nbsp;·&nbsp;1 min&nbsp;·&nbsp;simba-fs</footer>
<a class=entry-link aria-label="post link to mxlinux boot with systemd" href=https://blog.simba-fs.dev/posts/linux/mxlinux-boot-with-systemd/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>node require from project root</h2>
</header>
<section class=entry-content>
<p>問題 在寫一個專案的時候，有時候會有一些小程式重複在不同的檔案裡用到，這時候我們會把他打包成模組放在 lib/。但是如果資料夾結構有點點複雜的時候， require() 的路徑就會很複雜：
. ├── index.js ├── lib │ └── random.js └── routes └── page └── signup └── index.js 在 index.js 裡面如果要引入 random.js 就會變成這樣
const random = require('../../lib/random.js'); 爛解法 如果我們想要直接用 require('lib/random') 的話做簡單的方式是上傳 npm，但是這樣稍嫌麻煩，而且別的專案不一定用的到。每一次修改都要上傳 npm 很不方便。
好解法 在 linux 裡面要把執行檔做成指令有兩個方法
放到 /usr/bin 之類的地方 把這個路徑直接加到 PATH 裡面 在 node 裡面也有 path 設定，module.paths，在 require 時會去這個裡面的目路尋找檔案。所以如果要達成上述的功能的話就只要加這行就可以了
module.paths.push(process.cwd()); 這樣就可以直接用 require('lib/random') 引入了
參考資料 https://github.com/nodejs/node/issues/4223
https://github.com/nodejs/node/issues/1979
https://www.npmjs.com/package/rooty
^^^
這個是在 github issue 裡面看到的，沒試過，但是應該也可以用吧？只是我覺得沒有 paths 的解法來的優雅。</p>
</section>
<footer class=entry-footer>2020-September-2&nbsp;·&nbsp;1 min&nbsp;·&nbsp;simba-fs</footer>
<a class=entry-link aria-label="post link to node require from project root" href=https://blog.simba-fs.dev/posts/nodejs/node-require-from-project-root/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>vim auto comment plugin</h2>
</header>
<section class=entry-content>
<p>套件 nerdcommenter
好用的指令 在每次動作前都要按 &lt;leader>，預設是 反斜線 \
c&lt;space> 簡單來說就是 toggle 你的註解
cA 跳到行尾並在行尾加上註解</p>
</section>
<footer class=entry-footer>2020-August-25&nbsp;·&nbsp;1 min&nbsp;·&nbsp;simba-fs</footer>
<a class=entry-link aria-label="post link to vim auto comment plugin" href=https://blog.simba-fs.dev/posts/linux/vim/vim-auto-comment-plugin/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>文章更新時間錯亂問題</h2>
</header>
<section class=entry-content>
<p>問題 在設定完 GitHub Action 之後，我發現我的文章的更新時間都錯了，會全部變成當天日期。但是本地生成的就沒有這個問題，經過一番盤查和猜測後，我發現問題是因為 git 不會把 modified date 紀錄，因為每台電腦的時區都是不一樣的，紀錄起來沒有意義。但是我們需要這項 meta data，所以我們就要自己想法紀錄
解法 v1.0 首先，因為每一篇文章 hexo 都會紀錄建立時間，所以我們可以直接把他抓出來，然後把檔案的更新時間設成這個時間就可以啦！
更改檔案的 modified time 這個功能只要用我們最熟悉的 touch 就可以做到了。一般我們使用 touch 的時候會把 modified time 改成當下時間，那要改任意時間只要加上 -t 選項就可以啦
-t STAMP use [[CC]YY]MMDDhhmm[.ss] instead of current time 假設我們有個檔案 tmp ，我想把他的日期改成 1999/3/23 12:32:33 ，那我可以這樣下指令
ted timeouch -t'19993231232.33' tmp 抓出檔名、日期 # git create time grep -rnw source/_posts -e 'date' output:（這裡的 date: 後面我多加了一個空白，原因後面會說）
source/_posts/hexo-installation.md:3:date: 2020-02-10 17:26:45 source/_posts/blessed.md:3:date: 2020-02-17 23:24:10 source/_posts/bash.md:3:date: 2020-02-16 22:15:10 source/_posts/hexo-cli-extras....</p>
</section>
<footer class=entry-footer>2020-August-20&nbsp;·&nbsp;2 min&nbsp;·&nbsp;simba-fs</footer>
<a class=entry-link aria-label="post link to 文章更新時間錯亂問題" href=https://blog.simba-fs.dev/posts/hexo/%E6%96%87%E7%AB%A0%E6%9B%B4%E6%96%B0%E6%99%82%E9%96%93%E9%8C%AF%E4%BA%82%E5%95%8F%E9%A1%8C/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>express 重複 send</h2>
</header>
<section class=entry-content>
<p>問題 在 express route 裡面，我通常會在 res.send() 之類的函式前面都會加一個 return 防止因為程式邏輯漏洞造成重複送出然後噴 error。像是這樣
route.get('/', (req, res, next) => { return res.send('Hello world'); }); 但是如果我們用到 Promise 的時候 return 並不會跳出整個 route，所以我們需要另一個方法，我的想法是一個變數儲存是否送出，然後在每次送出前都判斷，送出候更改變數值
+--------------------------+ | is sent( flag === false) | +-+------------------------+ |no | +-+----+ | send | +-+----+ | +-+-----------+ | change flag | +-------------+ route.get('/', (req, res, next) => { let flag = false; doSomePromise() .then(() => { // do something if(!flag){ res.send('Hello world'); flag = true; } }) }) 這樣就不會噴一堆 error 啦！...</p>
</section>
<footer class=entry-footer>2020-August-19&nbsp;·&nbsp;1 min&nbsp;·&nbsp;simba-fs</footer>
<a class=entry-link aria-label="post link to express 重複 send" href=https://blog.simba-fs.dev/posts/nodejs/express-%E9%87%8D%E8%A4%87-send/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>加入 google search 和 sitemap</h2>
</header>
<section class=entry-content>
<p>前置設定 npm 安裝 hexo-generator-sitemap npm i -S hexo-generator-sitemap 設定插件 將以下內容加到 _config.yml
注意空白
# sitemap sitemap: path: sitemap.xml 驗證網域 如果你的 hexo 是架在自己的網域可以跳過這步
因為我的 hexo 是 託管在 GitHub page，在 Google Search Console 驗證的時候沒辦法用網域，所以要放一個特別的檔案到我們的網站根目錄
首先到 Google Search Console 新增一個網域 選擇右邊，輸入你的網址 下載提供的 html 並放到 source/ 資料夾 忽略 接下來會遇到 hexo 在生成的時候把這個 html 也放到模板裡面，所以我們要把他加入忽略清單裡面
在 _config.yml 裡面找到 skip_render
把直接檔名寫在後面或是用清單都可以 注意空白
# 直接寫 skip_render: 'googlebabababababa.html' # 或是用清單 skip_render: - 'googlebabababababa....</p>
</section>
<footer class=entry-footer>2020-August-19&nbsp;·&nbsp;1 min&nbsp;·&nbsp;simba-fs</footer>
<a class=entry-link aria-label="post link to 加入 google search 和 sitemap" href=https://blog.simba-fs.dev/posts/hexo/%E5%8A%A0%E5%85%A5-google-search-%E5%92%8C-sitemap/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>GitHub Action 自動部署 hexo</h2>
</header>
<section class=entry-content>
<p>前言 本來部署 hexo 都是手動下指令，但是這樣在手機上因為沒辦法裝 hexo ,所以一直不能在手機上寫文章。剛好想到 GitHub Action 可以滿足我的需求，上網查了一下資料發現蠻多人有和我一樣的需求，這次參考的是 owlran 大大的文章。
ssh key 因為要部署到 GitHub repo，最方便的方法當然是 ssh key 啦。
ssh-keygen 首先隨便找個資料夾產生一組 ssh key
ssh-keygen -f deploy-key GitHub 再來要讓 GitHub 知道你的 ssh key（public/secret 都要）
public key public key 是要放在你的 &lt;username>.github.io 的 repo 下
.ggithub.io -> settings -> Deploy keys -> add deploy key
新增一個 ssh key，名字叫 DEPLOY_KEY_PUB
把 depoly-key.pub 的內容貼上，記得下面的勾勾（Allow write access ）要選起來
secret key secret key 要放在你存放部落格檔案的 repo，owlran 大大是放在同一個 repo 不同 branch，我是放在兩個不同 repo，其中放部落格檔案的 repo 我設成 private repo（因為我放了一些 gitalk 要用的 clientSecret，這個不能公開）。...</p>
</section>
<footer class=entry-footer>2020-August-16&nbsp;·&nbsp;2 min&nbsp;·&nbsp;simba-fs</footer>
<a class=entry-link aria-label="post link to GitHub Action 自動部署 hexo" href=https://blog.simba-fs.dev/posts/hexo/github-action-%E8%87%AA%E5%8B%95%E9%83%A8%E7%BD%B2-hexo/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>React update state on props change</h2>
</header>
<section class=entry-content>
<p>問題 今天在研究 React 遇到一個問題 當我從外面更新 props 的時候 component 內的 state 不會更新
function Input(props){ const [text, setText] = React.useState(props.text); return ( &lt;input type="text" value={text}> ) } 如同上面程式，第二行的 useState 不會隨著 props 更新而更新
解法 後來找到解法，加上一個 useEffect 監聽 props.text 然後更新 state 就好了
function Input(props){ const [text, setText] = React.useState(props.text); React.useEffect(() => { setText(props.text); }, [props.text]); return ( &lt;input type="text" value={text}> ) } 如此一來 state 就會和 props 同步了
參考資料 https://stackoverflow.com/questions/54865764/react-usestate-does-not-reload-state-from-props https://zh-hant.reactjs.org/docs/hooks-effect.html</p>
</section>
<footer class=entry-footer>2020-July-12&nbsp;·&nbsp;1 min&nbsp;·&nbsp;simba-fs</footer>
<a class=entry-link aria-label="post link to React update state on props change" href=https://blog.simba-fs.dev/posts/nodejs/react/react-update-state-on-props-change/></a>
</article>
<footer class=page-footer>
<nav class=pagination>
<a class=prev href=https://blog.simba-fs.dev/posts/page/2/>« </a>
<a class=next href=https://blog.simba-fs.dev/posts/page/4/> »</a>
</nav>
</footer>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://blog.simba-fs.dev/>Simba's Blog</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)">
<button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</button>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>